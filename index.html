<!DOCTYPE html>
<html lang="zh-CN" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOEICè¯æ±‡å­¦ä¹ </title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        /* æ·±è‰²æ¨¡å¼ */
        html.dark {
            background-color: #1a1a1a;
            color: #ffffff;
        }
        html.dark body {
            background-color: #1a1a1a;
        }
        html.dark .bg-gray-100 {
            background-color: #1a1a1a;
        }
        html.dark .bg-white {
            background-color: #2d2d2d;
            color: #ffffff;
        }
        html.dark .text-gray-800 { color: #ffffff; }
        html.dark .text-gray-700 { color: #e0e0e0; }
        html.dark .text-gray-600 { color: #cccccc; }
        html.dark .text-gray-500 { color: #b3b3b3; }
        html.dark .border-t { border-color: #404040; }
        html.dark input {
            background-color: #2d2d2d;
            color: #ffffff;
            border-color: #404040;
        }
        html.dark input::placeholder {
            color: #888888;
        }
        html.dark .bg-opacity-50 {
            background-color: rgba(0, 0, 0, 0.75);
        }
        html.dark #helpModal .bg-white {
            background-color: #2d2d2d;
        }
        
        /* å¡ç‰‡åŸºç¡€æ ·å¼ */
        .word-card {
            transition: all 0.3s ease;
            perspective: 1000px;
            min-height: 200px;
            margin-bottom: 1rem;
        }
        .word-card:hover {
            transform: translateY(-2px);
        }

        /* ç¿»è½¬å¡ç‰‡æ ·å¼ */
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 200px;
            text-align: left;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .word-card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .card-back {
            transform: rotateY(180deg);
        }
        html.dark .card-front,
        html.dark .card-back {
            background-color: #2d2d2d;
            color: #ffffff;
        }
        
        /* é®ç½©æ•ˆæœ */
        .masked {
            filter: blur(5px);
            user-select: none;
            transition: filter 0.3s ease;
        }
        .masked:hover {
            filter: none;
        }
        
        /* å­—ä½“å¤§å° */
        .text-size-small { font-size: 0.9em; }
        .text-size-normal { font-size: 1em; }
        .text-size-large { font-size: 1.2em; }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container { padding: 0.5rem; }
            .button-group { flex-wrap: wrap; gap: 0.5rem; }
            .button-group button { width: calc(50% - 0.5rem); }
        }

        /* å·¥å…·æ  */
        .toolbar {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }
        .toolbar button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #4a5568;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .toolbar button:hover {
            transform: scale(1.1);
        }

        /* å¿«æ·é”®æç¤º */
        .shortcut-hint {
            font-size: 0.8em;
            color: #666;
            margin-left: 0.5em;
        }
        html.dark .shortcut-hint {
            color: #999;
        }
    </style>
</head>
<body class="bg-gray-100 transition-colors duration-200">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">TOEICé«˜é¢‘è¯æ±‡</h1>
            <p class="text-gray-600 mb-4">ç‚¹å‡»å•è¯æ—çš„å–‡å­å›¾æ ‡å¯æ”¶å¬å‘éŸ³<span class="shortcut-hint">(ç©ºæ ¼é”®ç¿»è½¬å¡ç‰‡)</span></p>
            
            <!-- è®¾ç½®åŒºåŸŸ -->
            <div class="settings-panel mb-4 flex justify-center gap-4 flex-wrap">
                <button onclick="toggleTheme()" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600" title="å¿«æ·é”®: D">
                    åˆ‡æ¢æ·±è‰²æ¨¡å¼
                </button>
                <div class="flex gap-2">
                    <button onclick="adjustFontSize('small')" class="px-3 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">A-</button>
                    <button onclick="adjustFontSize('normal')" class="px-3 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">A</button>
                    <button onclick="adjustFontSize('large')" class="px-3 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">A+</button>
                </div>
            </div>

            <!-- åŠŸèƒ½æŒ‰é’® -->
            <div class="button-group flex justify-center gap-4 mb-4">
                <button onclick="toggleMask('word')" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600" title="å¿«æ·é”®: E">
                    é®ç›–è‹±æ–‡
                </button>
                <button onclick="toggleMask('meaning')" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600" title="å¿«æ·é”®: C">
                    é®ç›–ä¸­æ–‡
                </button>
                <button onclick="toggleMask('none')" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600" title="å¿«æ·é”®: R">
                    æ˜¾ç¤ºå…¨éƒ¨
                </button>
                <button onclick="toggleCardMode()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600" title="å¿«æ·é”®: M">
                    åˆ‡æ¢å¡ç‰‡æ¨¡å¼
                </button>
                <button onclick="showFavorites()" class="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600">
                    æŸ¥çœ‹æ”¶è—å¤¹
                </button>
            </div>

            <!-- è¿›åº¦ä¿¡æ¯ -->
            <div id="progressInfo" class="text-sm text-gray-600 mb-4"></div>
            
            <!-- åˆ†ç»„æŒ‰é’® -->
            <div class="flex justify-center gap-4 mb-4 flex-wrap" id="groupButtons"></div>

            <!-- æœç´¢æ¡† -->
            <input 
                type="text" 
                id="searchInput" 
                placeholder="æœç´¢å•è¯... (æŒ‰ / é”®å¿«é€Ÿæœç´¢)" 
                class="w-full max-w-md px-4 py-2 rounded border focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
        </header>

        <!-- åŠ è½½æç¤º -->
        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <p class="mt-4">åŠ è½½ä¸­...</p>
        </div>

        <!-- å•è¯å±•ç¤ºåŒºåŸŸ -->
        <div id="wordContainer" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3"></div>
    </div>

    <!-- å·¥å…·æ  -->
    <div class="toolbar">
        <button onclick="scrollToTop()" title="è¿”å›é¡¶éƒ¨" class="hover:bg-gray-600">â†‘</button>
        <button onclick="toggleHelp()" title="å¸®åŠ©" class="hover:bg-gray-600">?</button>
    </div>

    <!-- å¸®åŠ©å¼¹çª— -->
    <div id="helpModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg max-w-md w-full mx-4">
            <h2 class="text-xl font-bold mb-4">å¿«æ·é”®æŒ‡å—</h2>
            <ul class="space-y-2">
                <li>ç©ºæ ¼é”®ï¼šç¿»è½¬å¡ç‰‡</li>
                <li>Dï¼šåˆ‡æ¢æ·±è‰²æ¨¡å¼</li>
                <li>Eï¼šé®ç›–è‹±æ–‡</li>
                <li>Cï¼šé®ç›–ä¸­æ–‡</li>
                <li>Rï¼šæ˜¾ç¤ºå…¨éƒ¨</li>
                <li>Mï¼šåˆ‡æ¢å¡ç‰‡æ¨¡å¼</li>
                <li>/ï¼šèšç„¦æœç´¢æ¡†</li>
                <li>1-9ï¼šåˆ‡æ¢å•è¯ç»„</li>
                <li>Escï¼šå…³é—­æ­¤çª—å£</li>
            </ul>
            <button onclick="toggleHelp()" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                å…³é—­
            </button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let vocabularyData = [];
        let currentMaskMode = 'none';
        let isCardMode = false;
        let currentFontSize = 'normal';
        let favorites = JSON.parse(localStorage.getItem('favorites')) || []; // æ”¶è—çš„å•è¯åˆ—è¡¨

        // åˆå§‹åŒ–ä¸»é¢˜
        function initTheme() {
            const isDark = localStorage.getItem('darkMode') === 'true';
            document.documentElement.classList.toggle('dark', isDark);
        }

        // åˆ‡æ¢ä¸»é¢˜
        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
        }

        // è°ƒæ•´å­—ä½“å¤§å°
        function adjustFontSize(size) {
            currentFontSize = size;
            document.querySelectorAll('.word-card').forEach(card => {
                card.classList.remove('text-size-small', 'text-size-normal', 'text-size-large');
                card.classList.add(`text-size-${size}`);
            });
            localStorage.setItem('fontSize', size);
        }

        // è¯­éŸ³åˆæˆ
        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        }

        // åˆ‡æ¢é®ç½©æ¨¡å¼
        function toggleMask(mode) {
            currentMaskMode = mode;
            const currentGroup = document.querySelector('#groupButtons .bg-blue-700')?.textContent;
            if (currentGroup) {
                showGroup(currentGroup);
            }
        }

        // åˆ‡æ¢å¡ç‰‡æ¨¡å¼
        function toggleCardMode() {
            isCardMode = !isCardMode;
            const currentGroup = document.querySelector('#groupButtons .bg-blue-700')?.textContent;
            if (currentGroup) {
                showGroup(currentGroup);
            }
        }

        // åˆ›å»ºæ™®é€šå•è¯å¡ç‰‡
        function createWordCard(word) {
            if (isCardMode) {
                return createFlipCard(word);
            }

            return `
                <div class="word-card bg-white rounded-lg shadow-md p-4 hover:shadow-lg text-size-${currentFontSize}">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-2">
                            <h2 class="text-xl font-bold text-gray-800 ${currentMaskMode === 'word' ? 'masked' : ''}">${word.Word}</h2>
                            <button 
                                onclick="speak('${word.Word}')"
                                class="p-2 rounded-full hover:bg-gray-100"
                                title="æ’­æ”¾å‘éŸ³"
                            >
                                ğŸ”Š
                            </button>
                            <button 
                                onclick="toggleFavorite('${word.Word}')"
                                class="p-2 rounded-full hover:bg-gray-100"
                                title="æ”¶è—å•è¯"
                            >
                                ${favorites.includes(word.Word) ? 'â­ï¸' : 'â˜†'}
                            </button>
                        </div>
                        <span class="text-sm font-medium text-gray-500">${word.POS}</span>
                    </div>
                    <p class="text-gray-700 mb-2 ${currentMaskMode === 'meaning' ? 'masked' : ''}">${word.Meaning}</p>
                    ${word.Note && word.Note !== '-' ? `<p class="text-sm text-gray-600 border-t pt-2 ${currentMaskMode === 'meaning' ? 'masked' : ''}">${word.Note}</p>` : ''}
                </div>
            `;
        }

        // åˆ›å»ºç¿»è½¬å¡ç‰‡
        function createFlipCard(word) {
            return `
                <div class="word-card bg-transparent" onclick="this.classList.toggle('flipped')">
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="flex justify-between items-start">
                                <h2 class="text-xl font-bold text-gray-800">${word.Word}</h2>
                                <button 
                                    onclick="speak('${word.Word}'); event.stopPropagation();"
                                    class="p-2 rounded-full hover:bg-gray-100"
                                    title="æ’­æ”¾å‘éŸ³"
                                >
                                    ğŸ”Š
                                </button>
                            </div>
                            <p class="text-sm text-gray-500 mt-2">${word.POS}</p>
                            <p class="text-sm text-gray-500 mt-4">ç‚¹å‡»å¡ç‰‡æŸ¥çœ‹é‡Šä¹‰</p>
                        </div>
                        <div class="card-back">
                            <div class="flex flex-col h-full">
                                <p class="text-gray-700 text-lg mb-4">${word.Meaning}</p>
                                ${word.Note && word.Note !== '-' ? 
                                    `<p class="text-sm text-gray-600 border-t pt-2 mt-auto">${word.Note}</p>` 
                                    : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // æ›´æ–°è¿›åº¦ä¿¡æ¯
        function updateProgress(groupName, total) {
            const progressInfo = document.getElementById('progressInfo');
            const currentGroupTotal = vocabularyData.filter(item => item.Group === groupName).length;
            progressInfo.textContent = `${groupName} (${currentGroupTotal}ä¸ªå•è¯) | æ€»è®¡ï¼š${total}ä¸ªå•è¯`;
        }

        // æ˜¾ç¤ºæŒ‡å®šç»„çš„å•è¯
        function showGroup(groupName) {
            const container = document.getElementById('wordContainer');
            const loading = document.getElementById('loading');

            loading.style.display = 'block';
            container.innerHTML = '';

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('#groupButtons button').forEach(btn => {
                if (btn.textContent === groupName) {
                    btn.classList.remove('bg-blue-500');
                    btn.classList.add('bg-blue-700');
                } else {
                    btn.classList.remove('bg-blue-700');
                    btn.classList.add('bg-blue-500');
                }
            });

            const groupData = vocabularyData.filter(item => item.Group === groupName);
            
            if (groupData.length === 0) {
                loading.style.display = 'none';
                return;
            }

            updateProgress(groupName, vocabularyData.length);
            container.innerHTML = groupData.map(createWordCard).join('');
            loading.style.display = 'none';
        }

        // æœç´¢åŠŸèƒ½
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchText = e.target.value.toLowerCase();
            const filteredWords = vocabularyData.filter(word => 
                word.Word.toLowerCase().includes(searchText) ||
                word.Meaning.toLowerCase().includes(searchText)
            );
            
            const container = document.getElementById('wordContainer');
            container.innerHTML = filteredWords.map(createWordCard).join('');
            updateProgress('æœç´¢ç»“æœ', vocabularyData.length);
        });

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            if (e.target.tagName === 'INPUT') return;
            
            switch(e.key) {
                case ' ': // ç©ºæ ¼é”®ç¿»è½¬å¡ç‰‡
                    e.preventDefault();
                    if (isCardMode) {
                        document.querySelectorAll('.word-card').forEach(card => 
                            card.classList.toggle('flipped'));
                    }
                    break;
                case 'd': // åˆ‡æ¢æ·±è‰²æ¨¡å¼
                    toggleTheme();
                    break;
                case 'e': // é®ç›–è‹±æ–‡
                    toggleMask('word');
                    break;
                case 'c': // é®ç›–ä¸­æ–‡
                    toggleMask('meaning');
                    break;
                case 'r': // æ˜¾ç¤ºå…¨éƒ¨
                    toggleMask('none');
                    break;
                case 'm': // åˆ‡æ¢å¡ç‰‡æ¨¡å¼
                    toggleCardMode();
                    break;
                case '/': // èšç„¦æœç´¢æ¡†
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                    break;
                case 'Escape': // å…³é—­å¸®åŠ©çª—å£
                    document.getElementById('helpModal').classList.add('hidden');
                    break;
            }
            
            // æ•°å­—é”®1-9åˆ‡æ¢å•è¯ç»„
            if (e.key >= '1' && e.key <= '9') {
                const buttons = document.querySelectorAll('#groupButtons button');
                const index = parseInt(e.key) - 1;
                if (buttons[index]) {
                    buttons[index].click();
                }
            }
        });

        // å›åˆ°é¡¶éƒ¨
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // æ˜¾ç¤º/éšè—å¸®åŠ©
        function toggleHelp() {
            document.getElementById('helpModal').classList.toggle('hidden');}

        // æ”¶è—å•è¯
        function toggleFavorite(word) {
            if (favorites.includes(word)) {
                favorites = favorites.filter(w => w !== word); // ç§»é™¤æ”¶è—
            } else {
                favorites.push(word); // æ·»åŠ æ”¶è—
            }
            localStorage.setItem('favorites', JSON.stringify(favorites)); // æ›´æ–°localStorage
            updateFavoriteButton(word); // æ›´æ–°æŒ‰é’®çŠ¶æ€
        }

        // æ›´æ–°æ”¶è—æŒ‰é’®çŠ¶æ€
        function updateFavoriteButton(word) {
            const buttons = document.querySelectorAll(`[onclick="toggleFavorite('${word}')"]`);
            buttons.forEach(button => {
                button.textContent = favorites.includes(word) ? 'â­ï¸' : 'â˜†';
            });
        }

        // æ˜¾ç¤ºæ”¶è—å¤¹
        function showFavorites() {
            const favoriteWords = vocabularyData.filter(word => favorites.includes(word.Word));
            const container = document.getElementById('wordContainer');
            container.innerHTML = favoriteWords.map(createWordCard).join('');
            updateProgress('æ”¶è—å¤¹', vocabularyData.length);
        }

        // åˆå§‹åŒ–
        initTheme();
        const savedFontSize = localStorage.getItem('fontSize');
        if (savedFontSize) {
            adjustFontSize(savedFontSize);
        }

        // åŠ è½½CSVæ•°æ®
        Papa.parse('vocabulary.csv', {
            download: true,
            header: true,
            encoding: "UTF-8",
            complete: function(results) {
                vocabularyData = results.data;
                
                // åˆ›å»ºç»„æŒ‰é’®
                const groupButtons = document.getElementById('groupButtons');
                const groups = new Set(vocabularyData.map(item => item.Group));
                
                groups.forEach(groupName => {
                    const button = document.createElement('button');
                    button.textContent = groupName;
                    button.className = "px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600";
                    button.onclick = () => showGroup(groupName);
                    groupButtons.appendChild(button);
                });

                // æ˜¾ç¤ºç¬¬ä¸€ç»„
                if (vocabularyData.length > 0) {
                    showGroup(vocabularyData[0].Group);
                }
            },
            error: function(error) {
                console.error('Error:', error);
                document.getElementById('debugInfo').style.display = 'block';
                document.getElementById('debugInfo').textContent = 'åŠ è½½è¯æ±‡æ•°æ®å‡ºé”™';
            }
        });
    </script>
</body>
</html>
