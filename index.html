<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOEICè¯æ±‡å­¦ä¹ </title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .word-card {
            transition: transform 0.2s;
        }
        .word-card:hover {
            transform: translateY(-2px);
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        #debugInfo {
            display: none;
        }
        .masked {
            filter: blur(5px);
            user-select: none;
        }
        .masked:hover {
            filter: none;
        }
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            .word-card {
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">TOEICé«˜é¢‘è¯æ±‡</h1>
            <p class="text-gray-600 mb-4">ç‚¹å‡»å•è¯æ—çš„å–‡å­å›¾æ ‡å¯æ”¶å¬å‘éŸ³</p>
            
            <!-- é®ç½©æ§åˆ¶æŒ‰é’® -->
            <div class="flex justify-center gap-4 mb-4">
                <button onclick="toggleMask('word')" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                    é®ç›–è‹±æ–‡
                </button>
                <button onclick="toggleMask('meaning')" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                    é®ç›–ä¸­æ–‡
                </button>
                <button onclick="toggleMask('none')" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">
                    æ˜¾ç¤ºå…¨éƒ¨
                </button>
            </div>

            <!-- è¿›åº¦æ˜¾ç¤º -->
            <div id="progressInfo" class="text-sm text-gray-600 mb-4"></div>
            
            <div id="debugInfo" class="text-sm text-gray-500 mb-4"></div>
            
            <div class="flex justify-center gap-4 mb-4 flex-wrap" id="groupButtons"></div>

            <input type="text" id="searchInput" placeholder="æœç´¢å•è¯..." 
                   class="w-full max-w-md px-4 py-2 rounded border focus:outline-none focus:ring-2 focus:ring-blue-500">
        </header>

        <div id="loading" class="loading">
            <p>åŠ è½½ä¸­...</p>
        </div>

        <div id="wordContainer" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <script>
        let vocabularyData = [];
        let currentMaskMode = 'none';

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        }

        function toggleMask(mode) {
            currentMaskMode = mode;
            const currentGroup = document.querySelector('#groupButtons .bg-blue-700')?.textContent;
            if (currentGroup) {
                showGroup(currentGroup);
            }
        }

        function createWordCard(word) {
            return `
                <div class="word-card bg-white rounded-lg shadow-md p-4 hover:shadow-lg">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-2">
                            <h2 class="text-xl font-bold text-gray-800 ${currentMaskMode === 'word' ? 'masked' : ''}">${word.Word}</h2>
                            <button 
                                onclick="speak('${word.Word}')"
                                class="p-2 rounded-full hover:bg-gray-100"
                                title="æ’­æ”¾å‘éŸ³"
                            >
                                ğŸ”Š
                            </button>
                        </div>
                        <span class="text-sm font-medium text-gray-500">${word.POS}</span>
                    </div>
                    <p class="text-gray-700 mb-2 ${currentMaskMode === 'meaning' ? 'masked' : ''}">${word.Meaning}</p>
                    ${word.Note && word.Note !== '-' ? `<p class="text-sm text-gray-600 border-t pt-2 ${currentMaskMode === 'meaning' ? 'masked' : ''}">${word.Note}</p>` : ''}
                </div>
            `;
        }

        function updateProgress(groupName, total) {
            const progressInfo = document.getElementById('progressInfo');
            const currentGroupTotal = vocabularyData.filter(item => item.Group === groupName).length;
            progressInfo.textContent = `å½“å‰ç»„ï¼š${groupName} (${currentGroupTotal}ä¸ªå•è¯) | æ€»è®¡ï¼š${total}ä¸ªå•è¯`;
        }

        function showGroup(groupName) {
            const container = document.getElementById('wordContainer');
            const loading = document.getElementById('loading');
            const debugInfo = document.getElementById('debugInfo');

            loading.style.display = 'block';
            container.innerHTML = '';

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('#groupButtons button').forEach(btn => {
                if (btn.textContent === groupName) {
                    btn.classList.remove('bg-blue-500');
                    btn.classList.add('bg-blue-700');
                } else {
                    btn.classList.remove('bg-blue-700');
                    btn.classList.add('bg-blue-500');
                }
            });

            const groupData = vocabularyData.filter(item => item.Group === groupName);
            
            if (groupData.length === 0) {
                debugInfo.textContent = `æ²¡æœ‰æ‰¾åˆ°ç»„ ${groupName} çš„æ•°æ®`;
                loading.style.display = 'none';
                return;
            }

            updateProgress(groupName, vocabularyData.length);
            container.innerHTML = groupData.map(createWordCard).join('');
            loading.style.display = 'none';
        }

        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchText = e.target.value.toLowerCase();
            const filteredWords = vocabularyData.filter(word => 
                word.Word.toLowerCase().includes(searchText) ||
                word.Meaning.toLowerCase().includes(searchText)
            );
            
            const container = document.getElementById('wordContainer');
            container.innerHTML = filteredWords.map(createWordCard).join('');
            updateProgress('æœç´¢ç»“æœ', vocabularyData.length);
        });

        // åŠ è½½CSVæ•°æ®
        Papa.parse('vocabulary.csv', {
            download: true,
            header: true,
            encoding: "UTF-8",
            complete: function(results) {
                vocabularyData = results.data;
                
                // åˆ›å»ºç»„æŒ‰é’®
                const groupButtons = document.getElementById('groupButtons');
                const groups = new Set(vocabularyData.map(item => item.Group));
                
                groups.forEach(groupName => {
                    const button = document.createElement('button');
                    button.textContent = groupName;
                    button.className = "px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600";
                    button.onclick = () => showGroup(groupName);
                    groupButtons.appendChild(button);
                });

                // æ˜¾ç¤ºç¬¬ä¸€ç»„
                if (vocabularyData.length > 0) {
                    showGroup(vocabularyData[0].Group);
                }
            },
            error: function(error) {
                console.error('Error:', error);
                document.getElementById('debugInfo').style.display = 'block';
                document.getElementById('debugInfo').textContent = 'åŠ è½½è¯æ±‡æ•°æ®å‡ºé”™';
            }
        });
    </script>
</body>
</html>
